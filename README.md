# 文件传输客户端

一个基于 Python asyncio 的高性能文件传输客户端，支持 IPv6 网络连接、断点续传、并发传输等功能。

## ✨ 功能特性

- 🚀 **异步并发传输** - 使用 asyncio 实现多文件并发传输，提高传输效率
- 🔄 **断点续传** - 支持传输中断后自动续传，无需重新传输已上传的数据
- 📁 **目录传输** - 支持递归传输整个文件夹，自动创建目录结构
- ✅ **完整性校验** - 使用 MD5 哈希值校验文件完整性，确保传输无误
- 📊 **进度显示** - 实时显示传输进度条，清晰了解传输状态
- 🔁 **自动重试** - 传输失败时自动重试（最多3次），采用指数退避策略
- 🌐 **IPv6 支持** - 支持 IPv6 网络连接
- 💪 **高吞吐量** - 4MB 缓冲区，优化大文件传输性能

## 📋 系统要求

- Python 3.7+
- 支持 IPv6 的网络环境

## 🔧 安装依赖

```bash
pip install aiofiles tqdm
```

## 📦 依赖说明

- `asyncio` - Python 标准库，用于异步编程
- `aiofiles` - 异步文件操作
- `tqdm` - 进度条显示
- `hashlib` - Python 标准库，用于文件哈希计算
- `pathlib` - Python 标准库，用于路径处理

## 🚀 使用方法

### 基本使用

```bash
python client.py
```

### 交互式操作

运行程序后，按提示操作：

1. **输入服务器 IPv6 地址**
   ```
   请输入服务器IPv6地址: [::1]
   ```

2. **选择传输模式**
   - `1` - 传输单个文件夹
   - `2` - 传输多个文件/文件夹

3. **设置并发数**（可选，默认 3）
   ```
   请输入最大并发传输数 (默认3): 5
   ```

4. **输入文件路径**
   - 模式 1：输入单个文件夹路径
   - 模式 2：输入多个文件/文件夹路径（每行一个，空行结束）

### 使用示例

#### 传输单个文件夹

```
=== 增强版文件传输客户端 ===
支持传输单个文件、多个文件或整个文件夹

请输入服务器IPv6地址: 2001:db8::1
请选择模式 (1/2): 1
请输入最大并发传输数 (默认3): 3
请输入文件夹路径: D:\Documents\MyFiles
```

#### 传输多个文件/文件夹

```
请输入服务器IPv6地址: 2001:db8::1
请选择模式 (1/2): 2
请输入最大并发传输数 (默认3): 5
请输入要传输的文件/文件夹路径（每行一个，空行结束）：
D:\file1.txt
D:\file2.pdf
D:\Documents\Folder1
[空行结束]
```

## 🔍 工作原理

### 传输流程

1. **文件检查阶段**
   - 计算本地文件的 MD5 哈希值
   - 向服务器发送文件检查请求（文件路径、大小、哈希值）
   - 服务器返回文件状态（完整/部分/不存在）

2. **断点续传判断**
   - 如果文件已完整存在，跳过传输
   - 如果文件部分存在，从断点位置继续传输
   - 如果文件不存在，从头开始传输

3. **数据传输阶段**
   - 使用异步并发传输多个文件
   - 每个文件使用 4MB 缓冲区进行分块传输
   - 实时显示传输进度

4. **完整性验证**
   - 传输完成后服务器验证文件完整性
   - 返回传输结果

### 目录传输

- 首先递归扫描目录结构
- 在服务器端创建所有子目录
- 然后并发传输所有文件

## ⚙️ 配置说明

在 `FileTransferClient` 类中可以调整以下参数：

- `buffer_size` - 缓冲区大小（默认 4MB）
- `port` - 服务器端口（默认 8888）
- `max_retries` - 最大重试次数（默认 3）

## 📝 注意事项

1. **服务器要求**：本客户端需要配合支持相同协议的服务器使用
2. **IPv6 连接**：确保客户端和服务器都支持 IPv6 网络
3. **网络稳定性**：虽然支持断点续传，但建议在稳定的网络环境下使用
4. **并发数设置**：根据网络带宽和服务器性能调整并发数，过高可能导致性能下降

## 🛠️ 代码结构

```
FileTransferClient
├── scan_directory()          # 递归扫描目录
├── get_directory_structure() # 获取目录结构
├── calculate_file_hash()     # 计算文件 MD5 哈希
├── create_directory()        # 在服务器创建目录
├── send_file()              # 发送单个文件（支持断点续传）
├── transfer_directory()      # 传输整个目录
└── send_files()             # 发送文件列表
```

## 📄 协议说明

客户端与服务器通信使用 JSON 格式，主要命令类型：

- `CHECK_FILE` - 检查文件状态
- `UPLOAD_FILE` - 上传文件
- `CREATE_DIR` - 创建目录
- `FINISH` - 结束会话

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

本项目采用 MIT 许可证。

## ⚠️ 免责声明

请确保您有权限传输相关文件，并遵守相关的法律法规。
